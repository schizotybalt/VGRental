DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'VGRental.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201404161824595_initial'
BEGIN
    CREATE TABLE [dbo].[Customers] (
        [customerID] [int] NOT NULL IDENTITY,
        [DOB] [datetime],
        [Email] [nvarchar](254) NOT NULL,
        [Name] [nvarchar](70) NOT NULL,
        [UserName] [nvarchar](254) NOT NULL,
        [Password] [nvarchar](max) NOT NULL,
        [ShippingAddress] [nvarchar](95) NOT NULL,
        [City] [nvarchar](35) NOT NULL,
        [State] [nvarchar](2) NOT NULL,
        [ZIP] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Customers] PRIMARY KEY ([customerID])
    )
    CREATE TABLE [dbo].[Orders] (
        [OrderID] [int] NOT NULL,
        [customerID] [int] NOT NULL,
        [GameName] [nvarchar](128) NOT NULL,
        [SystemName] [nvarchar](128) NOT NULL,
        [OrderDetails_OrderID] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Orders] PRIMARY KEY ([OrderID], [customerID])
    )
    CREATE INDEX [IX_customerID] ON [dbo].[Orders]([customerID])
    CREATE INDEX [IX_GameName_SystemName] ON [dbo].[Orders]([GameName], [SystemName])
    CREATE INDEX [IX_OrderDetails_OrderID] ON [dbo].[Orders]([OrderDetails_OrderID])
    CREATE TABLE [dbo].[Games] (
        [SystemName] [nvarchar](128) NOT NULL,
        [GameName] [nvarchar](128) NOT NULL,
        [Multiplayer] [bit],
        [NumberOfPlayers] [int],
        [Rating] [nvarchar](max),
        [Genre] [nvarchar](max),
        [QuantityAvail] [int] NOT NULL,
        [TotalQuantity] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Games] PRIMARY KEY ([SystemName], [GameName])
    )
    CREATE INDEX [IX_SystemName] ON [dbo].[Games]([SystemName])
    CREATE TABLE [dbo].[Systems] (
        [Name] [nvarchar](128) NOT NULL,
        [Manf] [nvarchar](max),
        [Version] [nvarchar](max),
        CONSTRAINT [PK_dbo.Systems] PRIMARY KEY ([Name])
    )
    CREATE TABLE [dbo].[OrderDetails] (
        [OrderID] [int] NOT NULL IDENTITY,
        [timestamp] [datetime] NOT NULL,
        [ShipDate] [datetime] NOT NULL,
        [Status] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.OrderDetails] PRIMARY KEY ([OrderID])
    )
    CREATE TABLE [dbo].[Promotions] (
        [OrderID] [int] NOT NULL,
        [PromotionID] [int] NOT NULL,
        [ExpirationDate] [datetime] NOT NULL,
        [Amount] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Promotions] PRIMARY KEY ([OrderID], [PromotionID])
    )
    CREATE INDEX [IX_OrderID_PromotionID] ON [dbo].[Promotions]([OrderID], [PromotionID])
    CREATE TABLE [dbo].[Subscriptions] (
        [customerID] [int] NOT NULL,
        [SubscriptionID] [int] NOT NULL,
        [Price] [real] NOT NULL,
        [ExpirationDate] [datetime] NOT NULL,
        [Description] [nvarchar](max),
        CONSTRAINT [PK_dbo.Subscriptions] PRIMARY KEY ([customerID], [SubscriptionID])
    )
    CREATE INDEX [IX_customerID] ON [dbo].[Subscriptions]([customerID])
    ALTER TABLE [dbo].[Orders] ADD CONSTRAINT [FK_dbo.Orders_dbo.Customers_customerID] FOREIGN KEY ([customerID]) REFERENCES [dbo].[Customers] ([customerID]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Orders] ADD CONSTRAINT [FK_dbo.Orders_dbo.Games_GameName_SystemName] FOREIGN KEY ([GameName], [SystemName]) REFERENCES [dbo].[Games] ([SystemName], [GameName]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Orders] ADD CONSTRAINT [FK_dbo.Orders_dbo.OrderDetails_OrderDetails_OrderID] FOREIGN KEY ([OrderDetails_OrderID]) REFERENCES [dbo].[OrderDetails] ([OrderID])
    ALTER TABLE [dbo].[Games] ADD CONSTRAINT [FK_dbo.Games_dbo.Systems_SystemName] FOREIGN KEY ([SystemName]) REFERENCES [dbo].[Systems] ([Name]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Promotions] ADD CONSTRAINT [FK_dbo.Promotions_dbo.Orders_OrderID_PromotionID] FOREIGN KEY ([OrderID], [PromotionID]) REFERENCES [dbo].[Orders] ([OrderID], [customerID])
    ALTER TABLE [dbo].[Subscriptions] ADD CONSTRAINT [FK_dbo.Subscriptions_dbo.Customers_customerID] FOREIGN KEY ([customerID]) REFERENCES [dbo].[Customers] ([customerID]) ON DELETE CASCADE
	ALTER TABLE[dbo].[Customers] ADD UNIQUE(Email)
	ALTER TABLE[dbo].[Customers] ADD UNIQUE(UserName)
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201404161824595_initial', N'VGRental.Migrations.Configuration',  0x1F8B0800000000000400ED1D5D6FE4B6F1BD40FF83A0A7B6B8EC7AED06498CDD04BE5DDB309A3B3B5EDF21E88B414BDCB5507D6C24CAB551E497E5213FA97FA1D437BF4551D2EE5E5B1C609C4971381CCE0C67869CF1BF7FFB7DFEC36BE05B2F304EBC285CD8B3C9896DC1D0895C2FDC2EEC146DBEFAD6FEE1FB3FFE617EE906AFD6E7EABBB3EC3B3C324C16F63342BBF3E934719E61009249E0397194441B3471A2600ADC687A7A72F2DD74369B420CC2C6B02C6B7E9F86C80B60FE0BFE7519850EDCA114F81F2217FA49D98E7BD63954EB230860B2030E5CD89FAFEF6188806F5B17BE07F0FC6BE86F6C0B84618400C2D89D7F4AE01AC551B85DEF7003F01FDE76107FB7017E024BACCF9BCF751770729A2D60DA0CAC40396982A2A023C0D9594991293BDC88AE764D314CB34B4C5BF496AD3AA7DBC25EE653C0D8B6D8C9CE977E9C7DD8907592EFC0A41AF2CEAA3ADED5BB8F9924FBF7CE5AA63E4A63B808618AE2EC8BBBF4C9F79CBFC1B787E81F305C84A9EF939861DC701FD5809BEEE2680763F4760F3725BE4E39F9CDCAB6A6F4F8290BA01E2E185BACEC264467A7B6F51123039E7C5833024185358A62780D43180304DD3B80108CF13EDEB8302725870533E7EAF67D35D90A0378C09CDD36E432009E5F0DC2DC8AC5CDB63E80D71F61B845CF0BFBF4EBBFDAD695F70ADDAAA5C4FA53E861E9C483509C42C1AAD4D3663F15B37E7332C6A4581EE39689475AEE1D48927F46B1AB9819FF778C99D7CFDE6E87E7BA70DD1826890281EFBE1E63FE65CEB6D249CF4699748DC549B9CB634CFAF79BBB364967007C042FDE36177C06D46DEC6215675BF7D0CFBB13BC89C5F932C9BB1E1B457A1547C17DE45783EA9EC707106F21C21845C2EE7594C64E0794D6E953E2C4DE2E47478819F9851041E1071C9EE2AF44E8CEA7CD01A33C76F2A5773873F2EF0F72E0E433F3A7CDE087533D4F277E353EE1D470AEF1CF16B53C3BFD76143DF1962018EC696EA96835B2D247DE2B0991C87B2566BA485DE74491225474B3C864AD1244F2AEAE48E4435710611345A10DCB0F1E4B316790A27AC55A91FEA4AB66C4BF065161300B30AC7B79F4982E0E37B6BF970E2C364C5B05669F1F44039222A9A1041BDDD15505EE55F68F46E37DC0DBE6ED7CF096B16231F9FB08731B085B2DF6347882F1EDE62E1F9C302A5F3DF61E335BB6BEDEC66F0B596118AB683ACC2C3FA52017AE8B17C273323BF91EB018FA15BCBD198F0ADD2D361A29B5AE6D30E6F22544A38057F6377810CDDC2142F6894E116D3D584DABAD098B0107D185668AED408A05849BD145AFA4FCF0F328CD20B12C6930312B4D22063777686ABBA89B5F530E3B26F766307F65B8485A16144E1008767C3CCD2000B322C211E680F0CA52550067A80892FA6419C60E173A096253DD484208A35C5B3CEA31C7241BC26F6B4C0FE6FB5318F40174F9BAF3E27C5F0611928B204A4334A829D5D7AD63595DE6F699993344B4AC8B51430C3BB29B15B15748E03BEE654C8B0E66F0E827429ED3186A5899FBDDD97D60E959418299F6666329E35F86516556E8D4B1671DD1BB4892C8F172F448EDD0E044AFF632742D759CAE206F7D7A621217BEB9E7E0D917F65F38024A41D6766603B2A1140D7566B3C2761BAEA00F11B42E9CE2D278091207B802C703CF4FB760F98471664F017F89370D2B082F44BC307BA1E3ED80AFC49D19D55D674CEB79D89E15DCC13033FB94FBD11F817A1E866C6D549A4F09D652731CE973C87843E845378C5138FFFAAC26F4671A709503746C5C26405B67872571477DE612505F675E65D4731F9C454486D44A870EF1F7D66174D449CDA687E72A1EE7BE9BDB29A86DA0E6C8EDEA37F511F32DED782A194EE285327C5C875658066C6167C95D538B94CC5803447BF5AC1722434EEA923498110E338DDDC964A25AB7F412ABDBA24D255232BD0EEF4A1DEE318D0FC94E0C8FAF2244B027D1145BEE323E6A31E3098B83F278F5CF9B96D7275F82E9AC5CC21E9958B957476848170E1D1E83B57308E3EA32A18C7AE4BD1E1405D23F25B08CA024A553CB725706780D11E3C962588D13C9B115C7A23490EAFE8E8350EAD196E1E58D0537FA5A7499C40E2ECE73D1F0CAD0D741BE3E3EC54BA8BB5B60D52A4C048938AFDAD644BF5CE3574629140618C151CC22896004F191F8D50ECBE2ADC1817A0D0D3B7072D21A0E2080108CC9AA267A851AABA72EBEF8A54B7DD4562F95C0B76462C59A457E2901A066E4DECB25EFCC651BCDFB4D6D9E93C90653BE521BB14C57CA5CE24856ACB0B8756D6E960212ADA06B64B712D480205C909FA786D202D7B2C109C44985A7A082CCE41E830492F02B4F080D6BAF83BD474A32ADBE1574515B783DB5611516AEAD88BA6F3E2D7283CA86F954924434FF00F297F8445251D962AD8B8CA2E557EBEE4937410163EA2482DC9B1ADB7A2614C5600B995E3C35C6F4CA8B13B402083C812C9ABF7403EE33CE66921CBDD574AC59C46F5E75185723B2FFD3F6D944C64D0D01AFF09A82CC3ECD6FFD053BCD0FB5B2942EE083587153B48CFC3408DB4D5639B43C2187049337E88F2FB373480865933E8C223A438290057864109ABC19124AD3AA0FA9C983212135ADFA90B8BC161220D7A90FB7C85721812D05CF45949815C927143E45933E8C3C9784849037081CFF2923019C33C54918E799D222AB25D0E5F16224CDC27352439425E36414ACA3252415152194FDE88326BC4AC252055DA55C46445E295653079B0FC32F85856AC42E22D35A835BC4C38625E6F89B4CBDD62681511D1D8E02F60D37752AB09DFA70ABF7DD24B8AAAD03DD8AE7DB14D18A267D18CCE36C1216D3A50F9379A54DC264BA8E46E02AF7D748E4C4CEBB86D0C9068E679914AF8E29C9C85BF421D44F8A492075E3D16C28E5229B9FBB1208BAC7AF74F8D8A730F11C9784443477B31C57BC8956B776B3F452D6F42CDB8E867388A08211DF3481D6EE4CA3183B36C750F75F94B3A1BA1893C3635FDA512E19D3A70FB57AAE4A42ABDA8E8683E8088CD99142C6D80D0E16E5F0FD98EEECD34F4AE895CF535550CB47A034837A7C9E950AC638AC49BD05A54218507A5D5230D9B84C4A47E8E4A76415B36D390AABCFB4DCCD2CD8A848516EBBD3EFA8F028A8E2AB52021F2354A577C783E8E6E1C452BE523664CBF30C17B9653FA939B68EE03291DA7919356DAF09C585518B4F6C0BE3FEE2B95908B5309227D90793F52FFED2F760A6EDAB0FB0FDEA6DB051533CAFB74F4F66A74C81A9E329F6344D12D717449D45159FE84D3B40F5252FA3726B5658D707F34DC125174344CCA37B9D9C46AA0053F80262E719C47C4DA21EF5958440B30A4B3DCB270D862C5B1DA902FCA700BCFE79A88A47426CB39A473D0A1A09619E758749D52B1293B54F39A29CF595C33B96D23110E60355B6695FBAB6EEE05E07DD842E7C5DD8FFCA879D5B373F3F3623DF593922E7D689F56BEFF2100D4768E0500D7E6C829734326C2E78EF9A3983A1371B003DB1E5D46D1B45303A6C68B79A2C06B274C01A299DF67A240E948B474FC082E2284F1EEA7AA04B0AA5309A4807125D36457A2A762E8DD20B92B0FC89899A15163F19F0A812E649EDA9EEC6702C4994D5E8B56D4CE98C0EB0CCAA520C6722989DF9435BFA5C410891BD6F5410C21C105510A28BD16C50466164934F119535DB7FDD63FE66F548CCDDCB6CBBE36B220C81CACC0015715EB831A7D1551586D4D1D2C0EE17524660CF9E81B8FE80C9E94B551F886156C6FCB03C26A83D30C021659CB5DFBC75DD776A10F3DCD924CBD628BB48F1CC72B44C22D963B083A70C99E5DE575911FB4D90A793220CB2FDCD92D164AF44F4ECE94E6C227904D6D1333E923C7AAD4DFAAFD028836C5BA790C648CAE77F242B7EB844F8BDB158CBABA62E4EC9188CA37B8FBB079E50662A75DF3FAD9A003D2A0C9873C31790FCFFFF7CFFA3B0AFE9CC5FE31A035F8CB5DDF20AEBE04637F34EA3BA70E552D3D8FD1427E12B73F08B7719D85D7D8AF0CE175EA53C2D5098E52ECFD01701976464B2900B5B90035C348BE08A937FB91CF8D20BE193DFCB0E1168590EB5901ABA39FF52DA74AE0AA02E0A209AE74E9A5FAB2C1AD05A3340483C55DAEAE865055819A093215549B4146B132FE1F4336565CB1BA46E00CDC864D6816A51A45435E941FD9734406D002DD4F6B443231700E891F33FCA72598BB8577ABF269A323B59F868BEFF12474BDF37573022CDCA3FF2D65F7A87C47CFE19273656883F008A0DA6C4DB3620B23F071A42873253EA6F6EC24D54594C0C46D527EC5D2EE67617DB301731F236C041B8DB8149925FF17F067E9AC5D48327E8DE84B729DAA5082F19064F3E955796595DAAF9F3EA0334CEF3DBE2101A6209184D2F8BF0DF86EF53CF776BBCAF0477401210993957DECB667B89B2FBD9ED5B0DE963146A022AC9575BA10F30D8F91858721BAEC10B34C1ED53027F845BE0BC55AF71E540DA378226FB7CE5816D0C82A484D18CC7BF621E7683D7EFFF03C86A9B9E07770000 , N'6.1.0-30225')
END

